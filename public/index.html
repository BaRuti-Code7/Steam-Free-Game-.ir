<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ø³ØªÛŒÙ… (Ø§Ø² SteamDB)</title>
  <style>
    body{font-family: system-ui, tahoma; margin:0; background:#0b0f13; color:#e6e7ea}
    .wrap{max-width:1100px; margin:40px auto; padding:0 16px}
    h1{margin:0 0 10px}
    h2{margin:32px 0 12px}
    .muted{opacity:.75; font-size:14px; margin-bottom:16px}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px}
    .card{background:#141a20; border:1px solid #1f2a33; border-radius:14px; overflow:hidden}
    .card img{width:100%; display:block}
    .title{font-weight:700; font-size:16px; margin:8px 0}
    .row{display:flex; align-items:center; justify-content:space-between; gap:8px}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; background:#243341; margin-inline-end:8px}
    .fk{background:#1e3a2d} .fw{background:#3a2a1e}
    a.btn{display:inline-block; background:#2b82f6; color:white; text-decoration:none; padding:8px 12px; border-radius:10px}
    .warn{margin-top:10px; font-size:13px; color:#f39c12}
    .box{background:#141a20; border:1px solid #1f2a33; border-radius:14px; padding:16px}
    ul.up{line-height:1.9; margin:8px 0 0 0}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†/ÙØ±ÛŒâ€ŒÙˆÛŒÚ©Ù†Ø¯ Ø§Ø³ØªÛŒÙ…</h1>
    <div class="muted">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù‡Ø± Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ ÛŒÚ©â€ŒØ¨Ø§Ø± ØªØ§Ø²Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</div>

    <div id="list" class="grid"></div>

    <h2>ğŸ¯ Ù¾Ø±ÙˆÙ…ÙˆØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</h2>
    <div id="upcoming" class="box">
      <div class="muted">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒâ€¦</div>
    </div>
  </div>

  <script>
    // ØªØ¨Ø¯ÛŒÙ„ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ (Ù…ÛŒÙ„Ø§Ø¯ÛŒ)
    const monthFa = {
      Jan: "Ú˜Ø§Ù†ÙˆÛŒÙ‡", Feb: "ÙÙˆØ±ÛŒÙ‡", Mar: "Ù…Ø§Ø±Ø³", Apr: "Ø¢ÙˆØ±ÛŒÙ„",
      May: "Ù…Ù‡", Jun: "Ú˜ÙˆØ¦Ù†", Jul: "Ú˜ÙˆØ¦ÛŒÙ‡", Aug: "Ø§ÙˆØª",
      Sep: "Ø³Ù¾ØªØ§Ù…Ø¨Ø±", Oct: "Ø§Ú©ØªØ¨Ø±", Nov: "Ù†ÙˆØ§Ù…Ø¨Ø±", Dec: "Ø¯Ø³Ø§Ù…Ø¨Ø±"
    };
    function toFaMonthLine(line){
      // Ù†Ù…ÙˆÙ†Ù‡ ÙˆØ±ÙˆØ¯ÛŒ SteamDB Ø¨Ø±Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒâ€ŒÙ‡Ø§: "Oct 2025: 911 Operator"
      // ÙÙ‚Ø· Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ù‡â€ŒØ­Ø±ÙÛŒ Ø§ÙˆÙ„ Ø±Ø§ ÙØ§Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      return line.replace(/\b(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\b/g, m => monthFa[m] || m);
    }

    (async function(){
      const listEl = document.getElementById('list');
      const upEl = document.getElementById('upcoming');

      listEl.innerHTML = `<div class="card" style="grid-column:1/-1"><div style="padding:16px">Ø¯Ø± Ø­Ø§Ù„ Ø¢ÙˆØ±Ø¯Ù† Ù„ÛŒØ³Øªâ€¦</div></div>`;

      try {
        const r = await fetch('/api/free').then(r=>r.json());

        // Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ
        if (!r.items || !r.items.length) {
          listEl.innerHTML = `<div class="card" style="grid-column:1/-1"><div style="padding:16px">ÙØ¹Ù„Ø§Ù‹ Ú†ÛŒØ²ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ø¨Ø¹Ø¯Ø§Ù‹ Ø³Ø± Ø¨Ø²Ù† ğŸ™‚</div></div>`;
        } else {
          listEl.innerHTML = r.items.map(x => `
            <div class="card">
              ${x.capsule ? `<img loading="lazy" src="${x.capsule}" alt="${x.name}"/>` : ""}
              <div style="padding:12px">
                <span class="badge ${x.promoType==='free_to_keep'?'fk':'fw'}">
                  ${x.promoType==='free_to_keep'?'Free to Keep':'Free Weekend'}
                </span>
                <div class="title">${x.name}</div>
                <div class="row" style="margin-top:10px">
                  <a class="btn" href="${x.storeUrl}" target="_blank" rel="noopener">ØµÙØ­Ù‡â€ŒÛŒ Ø§Ø³ØªÛŒÙ…</a>
                  <a class="muted" href="${x.steamdbUrl}" target="_blank" rel="noopener">SteamDB</a>
                </div>
              </div>
            </div>
          `).join('');
        }

        // Ø¨Ø®Ø´ Â«Ù¾Ø±ÙˆÙ…ÙˆØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡Â»
        const list = Array.isArray(r.upcoming) ? r.upcoming : [];
        if (!list.length) {
          upEl.innerHTML = `<div class="muted">ÙØ¹Ù„Ø§Ù‹ Ù…ÙˆØ±Ø¯ÛŒ Ø§Ø¹Ù„Ø§Ù… Ù†Ø´Ø¯Ù‡.</div>`;
        } else {
          upEl.innerHTML = `
            <ul class="up">
              ${list.map(x => `<li>${toFaMonthLine(x)}</li>`).join("")}
            </ul>
            <div class="warn">âš ï¸ Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Â«Ø§Ø­ØªÙ…Ø§Ù„ÛŒÂ» Ù‡Ø³ØªÙ†Ø¯ Ùˆ ØªØ¶Ù…ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø´Ø¯Ù† Ù‚Ø·Ø¹ÛŒ Ø¢Ù†â€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>
          `;
        }
      } catch (e) {
        listEl.innerHTML = `<div class="card" style="grid-column:1/-1"><div style="padding:16px">Ø§ÙˆÙ‡! Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡.</div></div>`;
        upEl.innerHTML = `<div class="muted">Ù†ØªÙˆØ§Ù†Ø³ØªÛŒÙ… Ø¨Ø®Ø´ Â«Ø§Ø­ØªÙ…Ø§Ù„ÛŒâ€ŒÙ‡Ø§Â» Ø±Ø§ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ú©Ù†ÛŒÙ….</div>`;
      }
    })();
  </script>
</body>
</html>
